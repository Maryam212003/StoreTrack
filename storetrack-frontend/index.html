<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StoreTrack - مدیریت انبار و فروش</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="jalali-date-picker.min.css">
</head>
<body>
    <header class="header">
        <h1 class="logo">StoreTrack</h1>
        <nav class="nav">
            <ul>
                <li><a href="#dashboard" class="nav-link active" data-page="dashboard"><i class="fas fa-home"></i> داشبورد</a></li>
                <li><a href="#products" class="nav-link" data-page="products"><i class="fas fa-box-open"></i> محصولات</a></li>
                <li><a href="#orders" class="nav-link" data-page="orders"><i class="fas fa-shopping-cart"></i> سفارشات</a></li>
                <li><a href="#reports" class="nav-link" data-page="reports"><i class="fas fa-chart-line"></i> گزارش‌ها</a></li>
            </ul>
        </nav>
    </header>

    <main class="container">
        <section id="dashboard" class="page active">
            <h2>داشبورد</h2>
            <div class="stats-container">
                <div class="stat-card">
                    <i class="fas fa-box"></i>
                    <h3>کل محصولات</h3>
                    <p id="total-products">0</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-chart-bar"></i>
                    <h3>کل سفارشات</h3>
                    <p id="total-orders">0</p>
                </div>
                <div class="stat-card low-stock-card">
                    <i class="fas fa-exclamation-triangle"></i>
                    <h3>محصولات کم‌موجودی</h3>
                    <p id="low-stock-count">0</p>
                    <button class="view-low-stock-btn" onclick="showLowStockModal()">مشاهده</button>
                </div>
            </div>
            <div class="recent-activity">
                <h3>آخرین فعالیت‌ها</h3>
                <ul id="recent-activity-list"></ul>
            </div>
        </section>

        <section id="products" class="page">
            <div class="page-header">
                <h2>مدیریت محصولات</h2>
                <button class="btn btn-primary" onclick="showProductModal()">+ افزودن محصول جدید</button>
            </div>
            <div class="filter-container">
                <input type="text" id="product-search" placeholder="جستجو بر اساس نام محصول...">
                <div class="custom-dropdown">
                    <div id="category-filter-header" class="custom-dropdown-header">
                        <span id="selected-category-filter-text">همه دسته‌بندی‌ها</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <ul id="category-filter-menu" class="custom-dropdown-menu"></ul>
                </div>
                <input type="hidden" id="category-filter-input">
                <button class="btn" onclick="filterProducts()"><i class="fas fa-search"></i> جستجو</button>
            </div>
            <table class="data-table">
                    <thead>
                        <tr>
                        <th>شماره محصول</th>
                        <th>نام محصول</th>
                        <th>دسته بندی</th>
                        <th>موجودی</th>
                        <th>قیمت</th>
                        <th>عملیات</th>
                        </tr>
                    </thead>
                <tbody id="products-list"></tbody>
                </table>
        </section>

        <section id="orders" class="page">
            <div class="page-header">
                <h2>مدیریت سفارشات</h2>
                <button class="btn btn-primary" onclick="showOrderModal()">+ ثبت سفارش جدید</button>
            </div>
            <div class="filter-container">
                <input type="text" id="order-start-date" data-jdp>
                <input type="text" id="order-end-date" data-jdp>
                <select id="order-status-filter">
                    <option value="">همه وضعیت‌ها</option>
                    <option value="PENDING">در انتظار</option>
                    <option value="SHIPPED">ارسال شده</option>
                    <option value="CANCELED">لغو شده</option>
                </select>
                <button class="btn" onclick="filterOrders()"><i class="fas fa-search"></i> جستجو</button>
            </div>
            <table class="data-table">
                    <thead>
                        <tr>
                        <th>شناسه سفارش</th>
                        <th>تاریخ</th>
                        <th>تعداد اقلام</th>
                        <th>مجموع مبلغ</th>
                        <th>وضعیت</th>
                        <th>عملیات</th>
                        </tr>
                    </thead>
                <tbody id="orders-list"></tbody>
                </table>
        </section>

        <section id="reports" class="page">
            <h2>گزارش‌ها</h2>
            <div class="reports-container">
                <div class="report-card mb-4">
                    <h3>گزارش فروش بر اساس محصول</h3>
                    <button id="fetch-sales-by-product-btn" class="btn btn-primary">دریافت گزارش</button>
                    <div class="table-responsive mt-3">
                        <table id="sales-by-product-table" class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th>نام محصول</th>
                                    <th>تعداد فروش</th>
                                    <th>مجموع فروش (ریال)</th>
                                </tr>
                            </thead>
                            <tbody>
                                </tbody>
                        </table>
                    </div>
                </div>

                <div class="report-card mb-4">
                    <h3>گزارش فروش بر اساس تاریخ</h3>
                    <div class="form-group">
                        <label for="start-date-input">از تاریخ:</label>
                        <input type="text" id="start-date-input" class="form-control" data-jdp>
                    </div>
                    <div class="form-group">
                        <label for="end-date-input">تا تاریخ:</label>
                        <input type="text" id="end-date-input" class="form-control" data-jdp>
                    </div>
                    <button id="fetch-sales-by-date-btn" class="btn btn-primary mt-2" onclick="fetchSalesByDate()">دریافت گزارش</button>
                    <div class="table-responsive mt-3">
                        <table id="sales-by-date-table" class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th>تاریخ</th>
                                    <th>مجموع فروش (ریال)</th>
                                </tr>
                            </thead>
                            <tbody>
                                </tbody>
                        </table>
                    </div>
                </div>

                <div class="report-card chart-card">
                    <h3>نمودار فروش بر اساس تاریخ</h3>
                    <div class="chart-container">
                        <canvas id="sales-chart"></canvas>
                    </div>
                </div>

                <div class="report-card">
                    <h3>تاریخچه موجودی</h3>
                    <div class="stock-history-filters">
                        <select id="history-product-id" class="form-control">
                            <option value="">همه محصولات</option>
                        </select>
                        <select id="history-type-filter" class="form-control">
                            <option value="">همه انواع</option>
                            <option value="IN">ورود</option>
                            <option value="OUT">خروج</option>
                        </select>
                        <input type="text" id="history-start-date" class="form-control" placeholder="از تاریخ" data-jdp>
                        <input type="text" id="history-end-date" class="form-control" placeholder="تا تاریخ" data-jdp>
                        <button class="btn btn-secondary" onclick="filterStockHistory()">فیلتر</button>
                    </div>
                    <div class="table-responsive mt-3">
                        <table class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th>تاریخ</th>
                                    <th>شماره محصول</th>
                                    <th>ورودی/خروجی</th>
                                    <th>تعداد</th>
                                </tr>
                            </thead>
                            <tbody id="stock-history-list">
                                </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <div id="product-modal" class="modal">
            <div class="modal-content">
            <span class="close-btn" onclick="closeModal('product-modal')">&times;</span>
            <h2 id="product-modal-title">افزودن محصول جدید</h2>
            <form id="product-form">
                <label for="product-name">نام محصول:</label>
                <input type="text" id="product-name" required>
                <label for="product-stock">موجودی:</label>
                <input type="number" id="product-stock" required>
                <label for="product-price">قیمت:</label>
                <input type="number" id="product-price" step="0.01" required>
                <label for="product-category">دسته بندی:</label>
                <div class="form-group">
                    <label for="product-category-input">دسته</label>
                    <div class="custom-dropdown">
                        <div id="product-category-header" class="custom-dropdown-header">
                            <span id="selected-product-category-text">انتخاب دسته‌بندی</span>
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <ul id="product-category-menu" class="custom-dropdown-menu"></ul>
                    </div>
                    <input type="hidden" id="product-category-input" required>
                </div>
                <button type="submit" class="btn btn-primary" id="save-product-btn">ذخیره</button>
                <input type="hidden" id="product-id">
                </form>
            </div>
        </div>

        <div id="order-modal" class="modal">
            <div class="modal-content">
                <span class="close-btn" onclick="closeModal('order-modal')">&times;</span>
                <h2>ثبت سفارش جدید</h2>
                <form id="order-form">
                    <div class="order-items-container">
                        <h3>اقلام سفارش</h3>
                        <div id="order-items-list"></div>
                        <div class="add-item-row">
                            <select id="add-order-product-select"></select>
                            <input type="number" id="add-order-quantity" placeholder="تعداد" min="1" value="1">
                            <button type="button" class="btn" onclick="addOrderItem()">+ اضافه کردن</button>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">ثبت سفارش</button>
                </form>
            </div>
        </div>
        <div id="add-product-modal" class="modal">
            <div class="modal-content">
                <span class="close-btn" onclick="closeModal('add-product-modal')">&times;</span>
                <h2>افزودن محصول جدید</h2>
                <form id="add-product-form">
                    <div class="form-group">
                        <label for="product-name">نام محصول</label>
                        <input type="text" id="product-name" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="product-category">دسته</label>
                        <select id="product-category" class="form-control" required></select>
                    </div>
                    <div class="form-group">
                        <label for="product-stock">موجودی</label>
                        <input type="number" id="product-stock" class="form-control" min="0" value="0" required>
                    </div>
                    <div class="form-group">
                        <label for="product-price">قیمت</label>
                        <input type="number" id="product-price" class="form-control" min="0" value="0" required>
                    </div>
                    <button type="submit" class="btn btn-primary">ثبت محصول</button>
                </form>
            </div>
        </div>

        <div id="low-stock-modal" class="modal">
            <div class="modal-content">
                <span class="close-btn" onclick="closeModal('low-stock-modal')">&times;</span>
                <h2>محصولات با موجودی کم</h2>
                <ul id="low-stock-list"></ul>
            </div>
        </div>

        <div id="order-detail-modal" class="modal">
            <div class="modal-content">
                <span class="close-btn" onclick="closeModal('order-detail-modal')">&times;</span>
                <h2 id="order-detail-title">جزئیات سفارش</h2>
                <div id="order-detail-content"></div>
                <button class="btn btn-danger" id="cancel-order-btn">لغو سفارش</button>
            </div>
        </div>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script src="jalali-moment.browser.js"></script>
    <script src="jalali-date-picker.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="script.js"></script>
</body>
</html>